
/** 실서버 반영
--SMPBORGS_USERS 테이블에 YSE_YN 컬럼 추가

--MCGOOD_HNS_APP 테이블 생성
*/

--UPDATE SMPBORGS_USERS SET USE_YN = 'Y'


SELECT	B.*
FROM	SMPBORGS A
INNER JOIN SMPBRANCHS B
	ON	B.BRANCHID = A.BORGID
WHERE	A.PARBORGID = '305952'
AND		A.ISUSE = '1'

--SMPBRANCHS 테이블에 BRANCH_LEVEL, PAR_BRANCHID 컬럼 추가
--SMPBRANCHS_HIST 테이블에 BRANCH_LEVEL, PAR_BRANCHID 컬럼 추가

UPDATE SMPBRANCHS SET BRANCH_LEVEL=0, PAR_BRANCHID='0'

UPDATE	SMPBRANCHS
SET		BRANCH_LEVEL=1
,		PAR_BRANCHID = '306228'
WHERE	BRANCHID IN (
		'306324','306364','306260','306262','306335',
		'306263','306261','306259','306264','306265',
		'306258','306717'
		)

UPDATE	SMPBRANCHS
SET		BRANCH_LEVEL=1
,		PAR_BRANCHID = '306354'
WHERE	BRANCHID IN (
		'306173','305967','305978','305982','306176',
		'305963','305980','306052','306147','306172',
		'306175','305985','306174','306377','306378',
		'306379','305964','305983','305984','306046',
		'306142','305960','305968','306271','306727',
		'306728'
		)

UPDATE	SMPBRANCHS
SET		BRANCH_LEVEL=1
,		PAR_BRANCHID = '306353'
WHERE	BRANCHID IN (
		'306269','305958','306029','306143','305970'
		,'306043','306145','306171','306168','306170'
		,'305955','306169','306371','306372','306373'
		,'306374','306375','306376','305974','305957'
		,'305969','306146','305954','305956','305971'
		,'305972','305959','305973','305975','306144'
		,'306150','306148','306725','306723','306722'
		,'306724','306726'
		)

UPDATE	SMPBRANCHS
SET		BRANCH_LEVEL=1
,		PAR_BRANCHID = '306355'
WHERE	BRANCHID IN (
		'305998','306058','305999','306059','306001'
		,'306340','306341','306037','306057','306381'
		,'306513','305997','306005','306003','306000'
		,'306002','306514','306731','306716'
		)

UPDATE	SMPBRANCHS
SET		BRANCH_LEVEL=1
,		PAR_BRANCHID = '306359'
WHERE	BRANCHID IN (
		'306028','306139','306177','305987','306025'
		,'306041','306178','306346','306347','306389'
		,'306388','306687','306024','306026','305988'
		,'306138','306022','306181','306135','306683'
		,'306730','306729'
		)

UPDATE	SMPBRANCHS
SET		BRANCH_LEVEL=1
,		PAR_BRANCHID = '306358'
WHERE	BRANCHID IN (
		'306012','306061','306270','306063','306011'
		,'306016','306039','306344','306345','306384'
		,'306385','306386','306387','306688','306013'
		,'306060','306014','306015','306062','306719'
		,'306732','306718','306720'
		)

UPDATE	SMPBRANCHS
SET		BRANCH_LEVEL=1
,		PAR_BRANCHID = '306356'
WHERE	BRANCHID IN (
		'306179','305990','305993','306036','306343'
		,'306383','306180','306136','305989','306342'
		,'306356'
		)

UPDATE	SMPBRANCHS
SET		BRANCH_LEVEL=1
,		PAR_BRANCHID = '306667'
WHERE	BRANCHID IN (
		'306659','306665','306666','306671','306672'
		,'306673','306674','306675','306677','306682'
		,'306686','306676','306680','306670','306678'
		,'306679','306681','306660','306661','306662'
		,'306663','306664','306703'
		)


--예산사용이력 백업
DECLARE @TABLE_NM VARCHAR(30);
DECLARE @SQL_STRING VARCHAR(1000);
SET @TABLE_NM='BUDGET_BREAKDOWN_'+convert(varchar(8),getdate(),112);
SET @SQL_STRING = 'SELECT * INTO '+@TABLE_NM+' FROM BUDGET_BREAKDOWN'
EXEC(@SQL_STRING)

--예산사용이력 마이그레이션
UPDATE	BUDGET_BREAKDOWN
SET		USED_BUDGET = (CASE		WHEN breakdown like '%차감%' and USED_BUDGET>0 then USED_BUDGET*(-1)
								WHEN breakdown like '%증감%' and USED_BUDGET<0 then USED_BUDGET*(-1)
								ELSE USED_BUDGET
						END)